#!/bin/sh
# NOTE: This file is generated from ~/.dotfiles/System.org.  Please see commentary there.

GREEN='\033[1;32m'
NC='\033[0m'
GUIX_EXTRA_PROFILES=$HOME/.guix-extra-profiles

__profiles=""
__substitute_urls=""
while [ "$1" != "" ]; do
    echo $1

    case $1 in
        --substitute-urls)
            __substitute_urls="$2"
            shift 2
            ;;
        -*|--*=) # unsupported flags
        echo "Error: Unsupported flags $1" >&2
        exit 1
        ;;
        *)
            __profiles="$__profiles $1"
            shift
            ;;
    esac
done

if [ -z "$__profiles" ]; then
    __profiles="$GUIX_EXTRA_PROFILES/*";
fi

__substitute_urls=${__substitute_urls:-https://ci.guix.gnu.org https://bordeaux.guix.gnu.org https://substitutes.nonguix.org}

for profile in $__profiles; do
  profileName=$(basename $profile)
  profilePath=$GUIX_EXTRA_PROFILES/$profileName

  echo
  echo -e "${GREEN}Updating profile:" $profilePath "${NC}"
  echo

  guix package --profile="$profilePath/$profileName" --manifest="$HOME/.config/guix/manifests/$profileName.scm" --substitute-urls="$__substitute_urls"

  notify-send "GUIX (Update Profile)" "Complete: $profileName"
done
